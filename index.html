<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Game Korea — Romaja (Mobile)</title>
<style>
  :root{
    --bg:#fff;
    --card:#ffffff;
    --ink:#0f172a;
    --muted:#64748b;
    --accent:#fb7185;     /* pink */
    --accent2:#60a5fa;    /* biru */
    --good:#22c55e;
    --bad:#ef4444;
    --ring:#00000012;
    --shadow:0 10px 30px rgba(2,6,23,.06);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--ink);
    background:
      radial-gradient(1400px 900px at 10% -10%, #ffe4e6 0%, transparent 60%),
      radial-gradient(1100px 800px at 110% -10%, #dbeafe 0%, transparent 60%),
      var(--bg);
    padding-bottom: env(safe-area-inset-bottom);
  }
  .wrap{max-width:720px;margin:auto;padding:12px 16px 20px}
  /* ====== HEADER / TABS ====== */
  header{
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:12px;
  }
  h1{
    margin:0 0 10px 0;
    font-size:clamp(18px, 2.8vw, 22px);
    letter-spacing:.2px;
  }
  .tabs{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
    background:#f1f5f9;
    padding:6px;
    border-radius:999px;
  }
  .tab{
    appearance:none;border:0;background:transparent;
    padding:10px 12px;border-radius:999px;
    font-weight:700;font-size:14px;line-height:1;cursor:pointer;
  }
  .tab[aria-pressed="true"]{background:var(--accent);color:#fff}

  /* ====== CARD ====== */
  .card{
    background:var(--card);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    padding:14px;
    margin-top:12px;
  }
  .row{display:flex;flex-direction:column;gap:10px}
  @media(min-width:720px){
    .row{flex-direction:row;flex-wrap:wrap;align-items:center}
  }
  .input, .select, .btn{
    width:100%;
    appearance:none;
    border:2px solid var(--ring);
    border-radius:12px;
    padding:12px 14px;
    font:600 16px/1.1 inherit;
    background:#fff;
  }
  .btn{cursor:pointer;text-align:center}
  .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
  .btn.ghost{background:#0000}
  .hint{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted)}
  .stat{display:flex;flex-wrap:wrap;gap:10px;font-size:14px;margin-top:8px;color:var(--muted)}
  .tag{display:inline-block;font:700 12px/1 inherit;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:999px;padding:6px 10px}

  /* ====== FLASH ====== */
  .flip{perspective:1000px;cursor:pointer;margin-top:8px}
  .flip-inner{
    position:relative;transform-style:preserve-3d;transition:transform .5s;
    min-height:160px;border-radius:16px;background:#fff;
    display:grid;place-items:center;border:2px dashed var(--ring)
  }
  .flip.flipped .flip-inner{transform:rotateY(180deg)}
  .face{position:absolute;inset:0;display:grid;place-items:center;padding:20px;backface-visibility:hidden;border-radius:16px}
  .front{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff}
  .back{background:#fff;transform:rotateY(180deg)}
  .big{
    font-weight:800;
    text-align:center;
    padding:6px 8px;
    font-size:clamp(22px, 6vw, 42px);
  }

  /* ====== QUIZ ====== */
  .question{
    font-weight:800;text-align:center;margin-top:6px;
    font-size:clamp(20px, 6vw, 36px)
  }
  .choices{display:grid;gap:10px;margin-top:12px}
  .choice{
    border:2px solid var(--ring);border-radius:14px;background:#fff;
    padding:14px;font:600 16px/1.2 inherit;text-align:left;
  }
  .choice.correct{border-color:var(--good)}
  .choice.wrong{border-color:var(--bad)}
  .foot{display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:12px;flex-wrap:wrap}
  .muted{opacity:.75}

  /* Better tap targets on mobile */
  @media (max-width:420px){
    .choices{gap:8px}
    .choice{padding:12px;font-size:15px}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- HEADER + TABS -->
  <header>
    <h1>🎌 Korea Mini — Romaja</h1>
    <div class="tabs" role="tablist" aria-label="Mode">
      <button id="tab-quiz"   class="tab" role="tab" aria-pressed="true">Kuis</button>
      <button id="tab-flash"  class="tab" role="tab" aria-pressed="false">Flashcard</button>
      <button id="tab-custom" class="tab" role="tab" aria-pressed="false">Kustom</button>
    </div>
  </header>

  <!-- KONTROL -->
  <section class="card">
    <div class="row">
      <label>
        <div class="muted" style="font-size:12px">Kategori</div>
        <select id="category" class="select">
          <option value="vocab" selected>Kosakata</option>
          <option value="phrases">Frasa / Kalimat</option>
        </select>
      </label>
      <label>
        <div class="muted" style="font-size:12px">Sumber Data</div>
        <select id="datasrc" class="select">
          <option value="base" selected>Data Bawaan</option>
          <option value="merge">Gabung (Bawaan + Custom)</option>
          <option value="custom">Hanya Custom</option>
        </select>
      </label>
      <label>
        <div class="muted" style="font-size:12px">Jumlah Soal</div>
        <select id="limit" class="select">
          <option>10</option><option selected>15</option><option>20</option>
        </select>
      </label>
      <label class="hint"><input type="checkbox" id="hideHangul" checked /> Sembunyikan Hangul</label>
      <button id="btnStart" class="btn primary">Mulai / Reset</button>
    </div>
    <div class="stat">
      <span>✅ Benar: <b id="right">0</b></span>
      <span>❌ Salah: <b id="wrong">0</b></span>
      <span>🔥 Streak: <b id="streak">0</b></span>
      <span>🎯 Target: <b id="target">15</b></span>
      <span class="tag">Sumber: <span id="activeSrc">Bawaan</span></span>
    </div>
  </section>

  <!-- QUIZ -->
  <section id="panel-quiz" class="card">
    <div class="tag">Kuis ▸ Pilih arti Indonesia</div>
    <div id="hangulHint" class="muted" style="display:none;margin-top:6px;text-align:center"></div>
    <div id="question" class="question">annyeonghaseyo</div>
    <div id="choices" class="choices"></div>
    <div class="foot">
      <div class="row" style="gap:8px;flex-direction:row">
        <button id="speakQuiz" class="btn">🔊 Dengar Pelafalan</button>
        <button id="btnHint" class="btn ghost">💡 Tampilkan Hangul</button>
      </div>
      <div class="row" style="gap:8px;flex-direction:row">
        <span class="muted">Soal <span id="qIndex">1</span>/<span id="qTotal">15</span></span>
        <button id="nextQ" class="btn">Berikutnya →</button>
      </div>
    </div>
  </section>

  <!-- FLASHCARD -->
  <section id="panel-flash" class="card" hidden>
    <div class="tag">Flashcard ▸ Romaja → Arti (ketuk kartu)</div>
    <div class="flip" id="flash">
      <div class="flip-inner">
        <div class="face front"><div id="flashFront" class="big">annyeonghaseyo</div></div>
        <div class="face back">
          <div>
            <div id="meanBack" class="big" style="margin-bottom:6px">halo/permisi</div>
            <div id="hangulBack" class="muted" style="text-align:center">안녕하세요</div>
          </div>
        </div>
      </div>
    </div>
    <div class="foot">
      <span class="muted">Kartu <span id="cardIndex">1</span>/<span id="cardTotal">15</span></span>
      <div class="row" style="gap:8px;flex-direction:row">
        <button id="speakFlash" class="btn">🔊 Dengar Pelafalan</button>
        <button id="prevCard" class="btn ghost">← Sebelum</button>
        <button id="nextCard" class="btn">Berikutnya →</button>
      </div>
    </div>
  </section>

  <!-- KUSTOM singkat (tetap ada, minimal) -->
  <section id="panel-custom" class="card" hidden>
    <div class="tag">Kustom Cepat</div>
    <div class="row" style="margin-top:8px">
      <input id="inRom" class="input" placeholder="romaja (wajib)"/>
      <input id="inHan" class="input" placeholder="hangul (wajib)"/>
      <input id="inInd" class="input" placeholder="arti (wajib)"/>
      <select id="inCat" class="select"><option value="vocab">Kosakata</option><option value="phrases">Frasa</option></select>
      <button id="btnAdd" class="btn primary">Tambah</button>
    </div>
    <p class="muted" style="font-size:12px;margin:10px 0 0">Data custom disimpan di perangkat (localStorage).</p>
  </section>
</div>

<script>
/* ========= DATA BAWAAN ========= */
const baseVocab=[{kr:"안녕하세요",rom:"annyeonghaseyo",id:"halo/permisi"},{kr:"감사합니다",rom:"gamsahamnida",id:"terima kasih"},{kr:"사랑해",rom:"saranghae",id:"aku cinta kamu"},{kr:"네",rom:"ne",id:"iya"},{kr:"아니요",rom:"aniyo",id:"tidak"},{kr:"미안해요",rom:"mianhaeyo",id:"maaf"},{kr:"주세요",rom:"juseyo",id:"tolong berikan"},{kr:"얼마예요?",rom:"eolmayeyo?",id:"berapa harganya?"},{kr:"맛있어요",rom:"masisseoyo",id:"enak"},{kr:"괜찮아요",rom:"gwaenchanayo",id:"tidak apa-apa"},{kr:"친구",rom:"chingu",id:"teman"},{kr:"학교",rom:"hakgyo",id:"sekolah"},{kr:"물",rom:"mul",id:"air"},{kr:"밥",rom:"bap",id:"nasi/makanan"},{kr:"사과",rom:"sagwa",id:"apel"},{kr:"시간",rom:"sigan",id:"waktu"},{kr:"집",rom:"jip",id:"rumah"},{kr:"사람",rom:"saram",id:"orang"}];
const basePhrases=[{kr:"저는 인도네시아 사람입니다.",rom:"jeoneun indonesia saramimnida.",id:"Saya orang Indonesia."},{kr:"천천히 말해 주세요.",rom:"cheoncheonhi malhae juseyo.",id:"Tolong bicara pelan-pelan."},{kr:"화장실이 어디예요?",rom:"hwajangsil-i eodi-yeyo?",id:"Di mana toilet?"},{kr:"도와줄 수 있어요?",rom:"dowajul su isseoyo?",id:"Bisakah bantu saya?"},{kr:"사진 찍어도 돼요?",rom:"sajin jjigeodo dwaeyo?",id:"Boleh ambil foto?"},{kr:"괜찮으세요?",rom:"gwaenchan-euseyo?",id:"Anda tidak apa-apa?"},{kr:"가격을 깎아 주세요.",rom:"gagyeogeul kkagga juseyo.",id:"Tolong kurangi harganya."}];
const LS={v:"kmc_vocab_v2",p:"kmc_phrases_v2",src:"kmc_src_v2"};
const $=s=>document.querySelector(s);
const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};
const vibrate=ms=>{if(navigator.vibrate) navigator.vibrate(ms)};
function speak(t,lang="ko-KR"){try{const u=new SpeechSynthesisUtterance(t);u.lang=lang;u.rate=.95;speechSynthesis.cancel();speechSynthesis.speak(u)}catch(e){}}
const load=(k,f)=>{try{return JSON.parse(localStorage.getItem(k))??f}catch(e){return f}};
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

/* ========= STATE ========= */
let mode="quiz", pool=[], idx=0, right=0, wrong=0, streak=0;
const el={
  tabQuiz:$("#tab-quiz"), tabFlash:$("#tab-flash"), tabCustom:$("#tab-custom"),
  pQuiz:$("#panel-quiz"), pFlash:$("#panel-flash"), pCustom:$("#panel-custom"),
  cat:$("#category"), src:$("#datasrc"), limit:$("#limit"), hide:$("#hideHangul"),
  start:$("#btnStart"), right:$("#right"), wrong:$("#wrong"), streak:$("#streak"), target:$("#target"), srcTag:$("#activeSrc"),
  q:$("#question"), choices:$("#choices"), qIndex:$("#qIndex"), qTotal:$("#qTotal"),
  speakQ:$("#speakQuiz"), hintBtn:$("#btnHint"), hangulHint:$("#hangulHint"), nextQ:$("#nextQ"),
  flash:$("#flash"), fFront:$("#flashFront"), fMean:$("#meanBack"), fHan:$("#hangulBack"),
  fPrev:$("#prevCard"), fNext:$("#nextCard"), fSpeak:$("#speakFlash"), cIndex:$("#cardIndex"), cTotal:$("#cardTotal"),
  inRom:$("#inRom"), inHan:$("#inHan"), inInd:$("#inInd"), inCat:$("#inCat"), add:$("#btnAdd")
};
el.src.value = load(LS.src,"base"); updateSrcTag();

/* ========= EVENT ========= */
[el.tabQuiz,el.tabFlash,el.tabCustom].forEach(btn=>
  btn.addEventListener("click",()=>switchMode(btn.id.replace("tab-","")))
);
el.start.addEventListener("click", resetGame);
el.limit.addEventListener("change",()=>el.target.textContent=el.limit.value);
el.src.addEventListener("change",()=>{save(LS.src,el.src.value);updateSrcTag();resetGame()});
el.hintBtn.addEventListener("click",()=>{toggle(el.hangulHint)});
el.speakQ.addEventListener("click",()=>speak(pool[idx].kr));
el.nextQ.addEventListener("click",()=>{ if(idx<pool.length-1){idx++; renderQuiz(); v()} });
el.flash.addEventListener("click",()=>{ el.flash.classList.toggle("flipped"); v(20) });
el.fPrev.addEventListener("click",()=>{ if(idx>0){idx--; renderFlash(); v()} });
el.fNext.addEventListener("click",()=>{ if(idx<pool.length-1){idx++; renderFlash(); v()} });
el.fSpeak.addEventListener("click",()=>speak(pool[idx].kr));
el.add.addEventListener("click", addCustom);

function v(ms=30){vibrate(ms)}
function toggle(n){n.style.display = (n.style.display==="none"||!n.style.display) ? "block":"none"}
function updateSrcTag(){ el.srcTag.textContent = el.src.value==="base"?"Bawaan":el.src.value==="merge"?"Gabung":"Hanya Custom" }

/* ========= DATASET ========= */
function custom(){ return {v:load(LS.v,[]), p:load(LS.p,[])} }
function dataset(){
  const src=el.src.value, cat=el.cat.value, c=custom();
  let arr=[];
  if(src==="base") arr=(cat==="vocab"? baseVocab:basePhrases);
  else if(src==="custom") arr=(cat==="vocab"? c.v:c.p);
  else arr=(cat==="vocab"? [...baseVocab,...c.v]:[...basePhrases,...c.p]);
  return arr.map(x=>({q:x.rom,a:x.id,rom:x.rom,kr:x.kr,id:x.id}));
}

/* ========= GAME FLOW ========= */
function resetGame(){
  right=wrong=streak=0; idx=0;
  el.right.textContent=0; el.wrong.textContent=0; el.streak.textContent=0;
  el.target.textContent=el.limit.value;

  const data=dataset();
  pool = shuffle([...data]).slice(0, Math.min(+el.limit.value, data.length));
  $("#cardTotal").textContent = pool.length; $("#qTotal").textContent = pool.length;
  if(pool.length===0){ alert("Dataset kosong. Tambah data di tab Kustom atau ganti Sumber Data."); return;}
  mode==="quiz" ? renderQuiz() : renderFlash();
}
function renderQuiz(){
  const it=pool[idx];
  el.qIndex.textContent=idx+1;
  el.q.textContent=it.q;
  el.hangulHint.textContent=it.kr;
  el.hangulHint.style.display = el.hide.checked ? "none":"block";
  // options: 1 benar + 3 salah
  const others = shuffle(dataset().filter(x=>x.a!==it.a)).slice(0,3);
  const options = shuffle([it.a, ...others.map(o=>o.a)]);
  el.choices.innerHTML="";
  options.forEach(op=>{
    const b=document.createElement("button");
    b.className="choice"; b.textContent=op;
    b.addEventListener("click",()=>{
      if(b.dataset.lock) return; [...el.choices.children].forEach(c=>c.dataset.lock=1);
      if(op===it.a){ b.classList.add("correct"); right++; streak++; v(40);}
      else{ b.classList.add("wrong"); streak=0; wrong++; v([20,40,20]); [...el.choices.children].find(x=>x.textContent===it.a)?.classList.add("correct");}
      el.right.textContent=right; el.wrong.textContent=wrong; el.streak.textContent=streak;
      if(idx<pool.length-1) setTimeout(()=>{idx++; renderQuiz()},650); else setTimeout(done,450);
    });
    el.choices.appendChild(b);
  });
}
function renderFlash(){
  const it=pool[idx];
  el.cIndex.textContent=idx+1;
  el.flash.classList.remove("flipped");
  el.fFront.textContent=it.rom;
  el.fMean.textContent=it.id;
  el.fHan.textContent=it.kr;
  el.fHan.style.display = el.hide.checked ? "none":"block";
}
function done(){
  const total=pool.length, score=Math.round((right/total)*100);
  alert(`Selesai!\nSkor: ${score}%\nBenar: ${right} | Salah: ${wrong}\n🔥 Streak: ${streak}`);
}

/* ========= MODE ========= */
function switchMode(m){
  mode=m; // "quiz" | "flash" | "custom"
  el.tabQuiz.setAttribute("aria-pressed", m==="quiz");
  el.tabFlash.setAttribute("aria-pressed", m==="flash");
  el.tabCustom.setAttribute("aria-pressed", m==="custom");
  el.pQuiz.hidden = m!=="quiz";
  el.pFlash.hidden = m!=="flash";
  el.pCustom.hidden= m!=="custom";
  if(m!=="custom") resetGame();
}

/* ========= CUSTOM ========= */
function addCustom(){
  const rom=el.inRom.value.trim(), kr=el.inHan.value.trim(), id=el.inInd.value.trim();
  if(!rom||!kr||!id){ alert("Isi romaja, hangul, dan arti."); return; }
  const c=custom();
  (el.inCat.value==="vocab"? c.v:c.p).push({rom,kr,id});
  save(LS.v,c.v); save(LS.p,c.p);
  el.inRom.value=el.inHan.value=el.inInd.value="";
  alert("Ditambahkan! (tersimpan di perangkat)");
}

/* boot */
switchMode("quiz");
</script>
</body>
</html>
